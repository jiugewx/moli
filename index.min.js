!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mobx"),require("react")):"function"==typeof define&&define.amd?define(["exports","mobx","react"],t):t(e.Moli={},e.mobx,e.React)}(this,function(e,t,n){"use strict";function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e[t],r=h[t],i=o?!0===n?function(){r.apply(this,arguments),o.apply(this,arguments)}:function(){o.apply(this,arguments),r.apply(this,arguments)}:r;e[t]=i}function r(e,t){if(null==e||null==t||"object"!==(void 0===e?"undefined":u(e))||"object"!==(void 0===t?"undefined":u(t)))return e!==t;var n=Object.keys(e);if(n.length!==Object.keys(t).length)return!0;for(var o=void 0,r=n.length-1;o=n[r];r--)if(t[o]!==e[o])return!0;return!1}function i(e){var t=e;if(!("function"!=typeof t||t.prototype&&t.prototype.render||t.isReactClass||s.Component.isPrototypeOf(t))){var o=function(e){function n(){return c(this,n),d(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,e),f(n,[{key:"render",value:function(){return t.call(this,this.props,this.context)}}]),n}(n.Component);return o.displayName=t.displayName||t.name,o.contextTypes=t.contextTypes,o.propTypes=t.propTypes,o.defaultProps=t.defaultProps,i(o)}if(!t)throw new Error("Please pass a valid component to 'observer'");return a(t.prototype||t),t.isMobXReactObserver=!0,t}function a(e){o(e,"componentWillMount",!0),["componentDidMount","componentWillUnmount","componentDidUpdate"].forEach(function(t){o(e,t)}),e.shouldComponentUpdate||(e.shouldComponentUpdate=h.shouldComponentUpdate)}var s="default"in n?n.default:n,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),p=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},l=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},h={componentWillMount:function(){function e(e){var n=this[e],o=new t.Atom("reactive "+e);Object.defineProperty(this,e,{configurable:!0,enumerable:!0,get:function(){return o.reportObserved(),n},set:function(e){!u&&r(n,e)?(n=e,a=!0,o.reportChanged(),a=!1):n=e}})}var n=this,o=this.displayName||this.name||this.constructor&&(this.constructor.displayName||this.constructor.name)||"<component>",i=this._reactInternalInstance&&this._reactInternalInstance._rootNodeID,a=!1,u=!1;e.call(this,"props"),e.call(this,"state");var c=this.render.bind(this),f=null,p=!1,l=function(){p=!1;var e=void 0;return f.track(function(){try{e=t.extras.allowStateChanges(!1,c)}catch(e){throw e}}),e};this.render=function(){return f=new t.Reaction(o+"#"+i+".render()",function(){if(!p&&(p=!0,"function"==typeof n.componentWillReact&&n.componentWillReact(),!0!==n.__$mobxIsUnmounted)){var e=!0;try{u=!0,a||s.Component.prototype.forceUpdate.call(n),e=!1}finally{u=!1,e&&f.dispose()}}}),l.$mobx=f,n.render=l,l()}},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t||r(this.props,e)}};i(function(e){return(0,e.children)()}).propTypes={children:function(e,t,n,o,r){if("function"!=typeof e[t])return new Error("Invalid prop `"+r+"` of type `"+u(e[t])+"` supplied to `"+n+"`, expected `function`.")}};var y=function(e){return void 0===e},b=function(e){return"[object Array]"===Object.prototype.toString.call(e)},m=function(e){return!b(e)&&"object"===(void 0===e?"undefined":u(e))},v=function e(t){var n=null;if(b(t)){n=[];for(var o=0;o<t.length;o++)n.push(e(t[o]))}else if(m(t)){n={};for(var r in t)n[r]=e(t[r])}else n=t;return n},g=function(){function e(t){c(this,e),this.$schema=v(t),this.appendState(this.$schema.state),this.appendAction(this,this.$schema.actions),this.appendGetter(this,this.$schema.getters)}return f(e,[{key:"appendState",value:function(e){if(void 0===e)return this;if("object"!==(void 0===e?"undefined":u(e)))return console.warn("state must be a object!"),this;for(var n in e)t.extendObservable(this,p({},n,e[n]))}},{key:"appendGetter",value:function(e,n){var o=this;if(void 0===n)return this;for(var r in n)!function(r){t.extendObservable(o,p({},r,t.computed(function(){return n[r].apply(e,arguments)})))}(r)}},{key:"appendAction",value:function(e,n){var o=this;if(void 0===n)return this;for(var r in n)!function(r){o[r]=t.action.bound(function(){return n[r].apply(e,arguments)})}(r)}}]),e}(),j=function(e){Object.defineProperty(e,"MoliInjector",{configurable:!0,enumerable:!0,writable:!1,value:!0})},_="$",O=function(){function e(){c(this,e),this.store={}}return f(e,[{key:"createModel",value:function(e){var t=new g(e);if(t instanceof g)return this.store[_+e.name]=t,t;throw Error("you should append a object which is Instance of Model!")}},{key:"createStore",value:function(e){if(y(e)||!m(e))return this.store;for(var t in e)e[t].name=t,this.store[_+t]=new g(e[t]);return this.store}},{key:"getStore",value:function(){return this.store}},{key:"inject",value:function(e){var t=this;if("function"==typeof e&&e.isReactClass){var o=e;return this._getInjectComponent(o)}return function(o){return o?t._getInjectComponent(o,e):t._getInjectComponent(n.Component,e)}}},{key:"copy",value:function(e,t){var n=this,o=this;return function(r){var i=n._getObserveClass(r),a=o._getModel(e);a.$schema.name=t||a.$schema.name;var s=function(e){function t(e,n){c(this,t);var o=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=new g(a.$schema);return o.state=Object.assign({},o.state),o.state[_+a.$schema.name]=r,o}return l(t,i),t}();return j(s),s}}},{key:"_getModel",value:function(e){return e instanceof g?e:"string"==typeof e&&this.store[_+e]?this.store[_+e]:null}},{key:"_getMobxProps",value:function(e){var t={};if("string"==typeof e){var n=this._getModel(e),o=n.$schema.name;t[_+o]=n}if(b(e))for(var r=0;r<e.length;r++){var i=this._getModel(e[r]),a=i.$schema.name;t[_+a]=i}return t}},{key:"_getObserveClass",value:function(e){var t=e;return e.MoliInjector||(t=i(e)),t}},{key:"_getInjectComponent",value:function(e,t){var n=this,o=this._getObserveClass(e);return y(t)?o.defaultProps=Object.assign(n.store,o.defaultProps):o.defaultProps=Object.assign(n._getMobxProps(t),o.defaultProps),j(o),o}}]),e}(),w=new O,x=w.store,C=w.copy.bind(w),M=w.inject.bind(w),P=w.createModel.bind(w),k=w.getStore.bind(w),S=w.createStore.bind(w);e.Moli=O,e.store=x,e.copy=C,e.inject=M,e.createModel=P,e.getStore=k,e.createStore=S,e.default=w,Object.defineProperty(e,"__esModule",{value:!0})});
